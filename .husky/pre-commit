echo "ğŸ” Running pre-commit quality checks..."

# First run full quality check (lint, format, type-check)
echo "ğŸ“‹ Step 1: Code quality check..."
if ! npm run quality; then
    echo ""
    echo "âŒ Code quality check failed!"
    echo "ğŸ’¡ Please fix the issues above before committing"
    echo "ğŸ”§ Common fixes:"
    echo "   npm run lint      # Auto-fix linting issues"
    echo "   npm run format    # Auto-format code"
    echo "   npm run type-check # Check TypeScript errors"
    echo ""
    exit 1
fi

echo "âœ… Code quality passed!"
echo ""

# Then run server startup health check
echo "ğŸš€ Step 2: Server startup health check..."
if ! npm run test:pre-commit; then
    echo ""
    echo "âŒ Server startup test failed!"
    echo "ğŸ’¡ Server hanging issue detected - commit blocked"
    echo "ğŸ”§ Try these fixes:"
    echo "   npm run emergency                # Quick recovery"
    echo "   ./scripts/emergency-recovery.sh  # Full recovery"
    echo "ğŸ“š See: CLAUDETroubleshooting.md"
    echo ""
    exit 1
fi

echo "âœ… Server startup healthy!"
echo ""
echo "ğŸ‰ All pre-commit checks passed - ready to commit!"