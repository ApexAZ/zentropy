<!DOCTYPE html>
<html>
<head>
    <title>OAuth Redirect</title>
</head>
<body>
    <script>
        // Extract parameters from URL
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        const error = urlParams.get('error');
        const errorDescription = urlParams.get('error_description');
        const state = urlParams.get('state');
        
        // Determine OAuth provider based on referrer URL
        const referrer = document.referrer || '';
        let provider = 'UNKNOWN';
        
        if (referrer.includes('github.com')) {
            provider = 'GITHUB';
        } else if (referrer.includes('microsoft') || referrer.includes('login.microsoftonline.com')) {
            provider = 'MICROSOFT';
        } else if (referrer.includes('google') || referrer.includes('accounts.google.com')) {
            provider = 'GOOGLE';
        }
        
        if (code) {
            // Send success message to parent window with authorization code
            window.opener.postMessage({
                type: `${provider}_OAUTH_SUCCESS`,
                authorizationCode: code
            }, window.location.origin);
        } else if (error) {
            // Send error message to parent window
            window.opener.postMessage({
                type: `${provider}_OAUTH_ERROR`,
                error: errorDescription || error
            }, window.location.origin);
        } else {
            // No code and no error - something went wrong
            window.opener.postMessage({
                type: `${provider}_OAUTH_ERROR`,
                error: `No authorization code received from ${provider.toLowerCase()} OAuth`
            }, window.location.origin);
        }
        
        // Close the popup window
        window.close();
    </script>
</body>
</html>